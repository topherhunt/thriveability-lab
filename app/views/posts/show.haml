.centered-800
  %h1= @post.title

  %p
    by #{link_to @post.author.full_name, user_path(@post.author)} on #{print_date @post.published_at, time: true}
    - if current_user == @post.author
      &nbsp;
      = link_to fa_icon("pencil") + " Edit", edit_post_path(@post), class: "edit-post-link btn btn-default btn-sm"
  %p Intention: <em>#{@post.conversant_records.find_by(user_id: @post.author_id)&.intention}</em>
  - if @post.tag_list.any?
    %p
      Tags:
      - @post.tag_list.each do |name|
        = link_to name, search_path(query: name), class: "btn btn-xs btn-default"

  %hr
  = sanitize(@post.published_content || @post.draft_content, tags: %w(h1 h2 h3 p blockquote pre strong em s a ul ol li table thead tbody tr th td img), attributes: %w(href src))

  %hr
  = render partial: "shared/likes_section", locals: { target: @post, link_wording: "This inspires me" }
  = render partial: "shared/stay_informed_flags_section", locals: { target: @post, owner: @post.author, link_wording: "Send me updates on this topic" }

  %hr
  - if @post.published?
    %h3 Discussion
    .js-post-comments-container
      - if current_user.present?
        %div{style: "padding-bottom: 10px;"}
          = link_to fa_icon("pencil") + " Add comment", "#", class: "js-new-reply btn btn-default btn-sm", "data-post-id": @post.id
          %i.fa.fa-spinner.loading.js-hidden
        .new-reply-container.js-hidden{ "data-parent-id": @post.id }

      - if @post.children.visible_to(current_user).not_inline.any?
        %div{style: "margin-left: -10px;"}
          - @post.children.visible_to(current_user).not_inline.order("created_at ASC").each do |reply|
            = render partial: "show_bottom_comment", locals: { post: reply }
      - else
        %p No comments yet.
